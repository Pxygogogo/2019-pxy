{extend name="base" /}
{block name="custom"}
<a href="{:url('index/custom/index')}" class="active list-group-item list-group-item-action waves-effect">
    <i class="fas fa-map mr-3"></i>客户管理</a>
{/block}

{block name="main"}

<!--Grid row-->
<div class="row wow fadeIn">
    <div style="text-align: center;margin-left:40%;"><h2 class="page-title">客户搜索</h2></div>
    <div class="col-md-12">
        <div class="collapse show" id="searchForm">
            <div class="card">
                <form class="form-horizontal" action="searchResult" method="post">
                    <div class="panel panel-default">
                        <div class="panel-heading" style="padding: 20px">
                            <h6 class="panel-title">客户搜索</h6>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="" class="col-sm-2 control-label">关键词</label>
                                <div class="col-sm-9">
                                    <input type="text" name="keywords" class="form-control"
                                           placeholder="请输入任意客户信息进行搜索...">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="padding: 25px">
                        <button class="btn btn-primary" type="submit">搜索</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div style="text-align: center;margin-left:40%;"><h2 class="page-title">新增客户</h2></div>
    <div class="col-md-12">
        <div id="cargo" class="collapse show">
            <div class="card">
                <form class="form-horizontal" id="form" action="addClient" method="post">
                    <div class="panel panel-default">
                        <div class="panel-heading" style="padding: 20px">

                        </div>
                        <div class="panel-body">
                            <div class="form-group" style="padding-left: 26px">
                                <div class="row">
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">客户中文名</label>
                                        <input type="text" name="cname" class="form-control" placeholder="">
                                    </div>
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">客户英文名</label>
                                        <input type="text" name="ename" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">客户简称</label>
                                        <input type="text" name="sname" class="form-control"
                                               placeholder="">
                                    </div>
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">客户所在省市区</label>
                                        <input type="text" name="area" class="form-control"
                                               placeholder="">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">负责人</label>
                                        <input type="text" name="principle" class="form-control"
                                               placeholder="">
                                    </div>
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">负责人联系电话</label>
                                        <input type="text" name="prin_phone" class="form-control"
                                               placeholder="">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">客户地址</label>
                                        <input type="text" name="location" class="form-control" placeholder="">
                                    </div>
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">电子邮箱</label>
                                        <input type="email" name="email" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">邮政编码</label>
                                        <input type="text" name="postcode" class="form-control" placeholder="">
                                    </div>
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">开户银行</label>
                                        <input type="text" name="bank" class="form-control"
                                               placeholder="">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">银行账户</label>
                                        <input type="text" name="bank_account" class="form-control"
                                               placeholder="">
                                    </div>
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">联系人一</label>
                                        <div class="input-group">
                                            <input type="text" name="contact1" id="contact1"
                                                   class="form-control contact"
                                                   placeholder="请输入联系人名称进行查找...">
                                            <span class="input-group-btn"><button
                                                    class="btn btn-primary search_contact" id="search_contact1"
                                                    type="button">查询</button></span>
                                        </div><!-- /input-group -->
                                    </div><!-- /.col-sm-6 -->
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <div id="">

                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="contact_result1">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">联系人二</label>
                                        <div class="input-group">
                                            <input type="text" name="contact2" id="contact2"
                                                   class="form-control contact"
                                                   placeholder="请输入联系人名称进行查找...">
                                            <span class="input-group-btn"><button
                                                    class="btn btn-primary search_contact" id="search_contact2"
                                                    type="button">查询</button></span>
                                        </div><!-- /input-group -->
                                    </div><!-- /.col-sm-6 -->
                                    <div class="col-sm-5">
                                        <label for="" class="col-sm-5 control-label">联系人三</label>
                                        <div class="input-group">
                                            <input type="text" name="contact3" id="contact3"
                                                   class="form-control contact"
                                                   placeholder="请输入联系人名称进行查找...">
                                            <span class="input-group-btn"><button
                                                    class="btn btn-primary search_contact" id="search_contact3"
                                                    type="button">查询</button></span>
                                        </div><!-- /input-group -->
                                    </div><!-- /.col-sm-6 -->
                                </div>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <div class="contact_result2">

                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="contact_result3">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="padding: 25px">
                        <button class="btn btn-primary" type="submit">确定新增</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div style="text-align: center;margin-left:38%;margin-top: 20px;"><h2 class="page-title">现有客户管理</h2></div>
    <!--Grid column-->
    <div class="col-md-12">

        <!--        <div>-->
        <!--            <button type="button" class="btn btn-primary">增加货物</button>-->
        <!--        </div>-->

        <!--Card-->
        <div class="card">

            <!--Card content-->
            <div class="card-body">

                <!-- Table  -->
                <table class="table table-hover">
                    <!-- Table head -->
                    <thead class="blue-grey lighten-4">
                    <tr style="text-align: center">
                        <th>编号</th>
                        <th>中文名</th>
                        <th>英文名</th>
                        <th>所在省市区</th>
                        <th>负责人</th>
                        <th>负责人联系方式</th>
                        <th>邮箱</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <!-- Table head -->

                    <!-- Table body -->
                    <tbody>
                    {foreach name='custom' key='key' item='vo'}
                    <tr style="border-bottom: 1px solid #dee2e6; text-align: center;">
                        <td>{$vo['custom_id']}</td>
                        <td>{$vo['cname']}</td>
                        <td>{$vo['ename']}</td>
                        <td>{$vo['area']}</td>
                        <td>{$vo['principle']}</td>
                        <td>{$vo['prin_phone']}</td>
                        <td>{$vo['email']}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="del({$vo['custom_id']})">删除</button>
                            <button class="btn btn-primary btn-sm" onclick="change({$vo['custom_id']})">修改</button>
                        </td>
                    </tr>
                    {/foreach}
                    </tbody>
                    <!-- Table body -->
                </table>
                <!-- Table  -->

            </div>

        </div>
        <!--/.Card-->

    </div>
    <!--Grid column-->


</div>
<!--Grid row-->

{/block}

{block name="script"}
<script>
    function del(custom_id) {
        if (confirm('确定要删除吗？')) {
            location.href = "{:url('del')}" + '?custom_id=' + custom_id;
        } else {

        }
    }

    function change(custom_id) {
        location.href = "{:url('change')}" + '?custom_id=' + custom_id;
    }
</script>

<script>
    $(function () {
        let contact_result = [];
        let contact_result_length = [];
        $('#search_contact1').on('click', function () {
            $('.contact_result1').html('');
            const contact_name = $('#contact1').val();
            $.post('/index/custom/searchContact', {"contact_name": contact_name}, function (data) {
                if (data.msg === '查询失败！') {
                    $('.contact_result1').append('不存在此联系人,请重新查询');
                } else {
                    contact_result = data.data;
                    contact_result_length = data.data.length;
                    for (let i = 0; i < contact_result_length; i++) {
                        $('.contact_result1').append(`<div class="contact_res col-sm-4" id="${i}" style="background: #f1f2f3;line-height: 40px;text-align: center;padding: 2px;font-size: 20px;margin-bottom: 5px;cursor: pointer;border-radius: 20px;">${data.data[i].name}</div>`)
                    }
                }
            });
        });
        $('.contact_result1').on('click', ".contact_res", function () {
            $('#contact1').val(contact_result[this.id].name);
            $('.contact_result1').html('');
        });
        //联系人2
        $('#search_contact2').on('click', function () {
            $('.contact_result2').html('');
            const contact_name = $('#contact2').val();
            $.post('/index/custom/searchContact', {"contact_name": contact_name}, function (data) {
                if (data.msg === '查询失败！') {
                    $('.contact_result2').append('不存在此联系人,请重新查询');
                } else {
                    contact_result = data.data;
                    contact_result_length = data.data.length;
                    for (let i = 0; i < contact_result_length; i++) {
                        $('.contact_result2').append(`<div class="contact_res col-sm-4" id="${i}" style="background: #f2f2f3;line-height: 40px;text-align: center;padding: 2px;font-size: 20px;margin-bottom: 5px;cursor: pointer;border-radius: 20px;">${data.data[i].name}</div>`)
                    }
                }
            });
        });
        $('.contact_result2').on('click', ".contact_res", function () {
            $('#contact2').val(contact_result[this.id].name);
            $('.contact_result2').html('');
        });
        //联系人2
        $('#search_contact3').on('click', function () {
            $('.contact_result3').html('');
            const contact_name = $('#contact3').val();
            $.post('/index/custom/searchContact', {"contact_name": contact_name}, function (data) {
                if (data.msg === '查询失败！') {
                    $('.contact_result3').append('不存在此联系人,请重新查询');
                } else {
                    contact_result = data.data;
                    contact_result_length = data.data.length;
                    for (let i = 0; i < contact_result_length; i++) {
                        $('.contact_result3').append(`<div class="contact_res col-sm-4" id="${i}" style="background: #f2f2f3;line-height: 40px;text-align: center;padding: 2px;font-size: 20px;margin-bottom: 5px;cursor: pointer;border-radius: 20px;">${data.data[i].name}</div>`)
                    }
                }
            });
        });
        $('.contact_result3').on('click', ".contact_res", function () {
            $('#contact3').val(contact_result[this.id].name);
            $('.contact_result3').html('');
        });


    })
</script>
{/block}